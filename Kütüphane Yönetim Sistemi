using System.Collections.Generic;

class Kitap
{
    public int ISBN { get; set; }
    public string KitapAdi { get; set; }
    public string Yazar { get; set; }
    public int YayinYili { get; set; }
    public bool Mevcut { get; set; }

    public Kitap(int isbn, string kitapAdi, string yazar, int yayinYili, bool mevcut)
    {
        ISBN = isbn;
        KitapAdi = kitapAdi;
        Yazar = yazar;
        YayinYili = yayinYili;
        Mevcut = mevcut;
    }
}

class Kullanici
{
    public int ID { get; set; }
    public string Isim { get; set; }
    public string Soyisim { get; set; }
    public string Bolum { get; set; }
    public int DogumYili { get; set; }
    public List<int> OduncKitaplar { get; set; }

    public Kullanici(int id, string isim, string soyisim, string bolum, int dogumYili)
    {
        ID = id;
        Isim = isim;
        Soyisim = soyisim;
        Bolum = bolum;
        DogumYili = dogumYili;
        OduncKitaplar = new List<int>();
    }

    public void OduncKitapEkle(int isbn)
    {
        OduncKitaplar.Add(isbn);
    }
}

class Program
{
    static List<Kitap> kitapListesi = new List<Kitap>();
    static List<Kullanici> kullaniciListesi = new List<Kullanici>();

    static void Main()
    {
        Console.Clear();
        Console.WriteLine("Yiğit Koçak Nesne Yönelimli Programlama I Ödevi Kütüphane Yönetim Sistemi");
        Menu();
    }

    static void Menu()
    {
        int secim;
        do
        {
            Console.WriteLine("");
            Console.WriteLine("Kitap Ekle ----->(1)             ");
            Console.WriteLine("Kullanıcı Ekle ----->(2)         ");
            Console.WriteLine("Kitap Teslim Al ----->(3)        ");
            Console.WriteLine("Kitap Ödünç Ver ----->(4)        ");
            Console.WriteLine("Kitap Teslim Et ----->(5)        ");
            Console.WriteLine("Kullanıcı Listele ----->(6)      ");
            Console.WriteLine("Kitap Listele ----->(7)          ");
            Console.WriteLine("Kitap Dosyası Aç ----->(8)       ");
            Console.WriteLine("Kullanıcı Dosyasını Aç ----->(9) ");
            Console.WriteLine("Ana Menüye Dön ----->(0)         ");                      
            Console.Write("Hangi İşlemi yapmak istiyorsanız o numarayı girin: ");
            secim = Convert.ToInt32(Console.ReadLine());          

            switch (secim)
            {
                case 0:
                    Main();
                    break;
                case 1:
                    KitapEkle();
                    break;
                case 2:
                    KullaniciEkle();
                    break;
                case 3:
                    KitapTeslimAl();
                    break;
                case 4:
                    KitapOduncVer();
                    break;
                case 5:
                    KitapTeslimEt();
                    break;
                case 6:
                    KullaniciListele();
                    break;
                case 7:
                    KitapListele();
                    break;
                case 8:
                    kitapDosya();
                    break;
                case 9:
                    kullaniciDosya();
                    break;
                default:
                    Console.Clear();
                    Console.WriteLine("$Hata: Geçersiz işlem numarası girdiniz!\nLütfen tekrar deneyiniz.");
                    break;
            }
        } while (secim != 0);
    }

    static void KitapEkle()
    {
        Console.Clear();        
        Console.WriteLine("Eklemek istediğiniz kitabın bilgilerini giriniz.");      
        Console.WriteLine("\n\n");

        Console.Write("ISBN:");
        int isbn = Convert.ToInt32(Console.ReadLine());

        Console.Write("Kitap Adı: ");
        string kitapAdi = Console.ReadLine();

        Console.Write("Yazar: ");
        string yazar = Console.ReadLine();

        Console.Write("Yayın Yılı: ");
        int yayinYil = Convert.ToInt32(Console.ReadLine());

        Console.Write("Mevcut (true/false): ");
        bool mevcut = Convert.ToBoolean(Console.ReadLine());

        Kitap kitap = new Kitap(isbn, kitapAdi, yazar, yayinYil, mevcut);
        kitapListesi.Add(kitap);
        Console.Clear();
        Console.WriteLine("\n\n\n[*]Kitap ekleme işleminiz başarılı bir şekilde kaydedilmiştir!");
    }

    static void KullaniciEkle()
    {
        Console.Clear();       
        Console.WriteLine("Kullanıcı hakkındaki bilgileri giriniz.");
        
        Console.Write("ID : ");
        int id = Convert.ToInt32(Console.ReadLine());

        Console.Write("İsim: ");
        string isim = Console.ReadLine();

        Console.Write("Soyisim: ");
        string soyisim = Console.ReadLine();

        Console.Write("Doğum Yılı: ");
        int dogumYili = Convert.ToInt32(Console.ReadLine());

        Console.Write("Okuduğu Bölüm: ");
        string bolum = Console.ReadLine();

        Kullanici kullanici = new Kullanici(id, isim, soyisim, bolum, dogumYili);
        kullaniciListesi.Add(kullanici);

        Console.Clear();
        Console.WriteLine("\n\n\n[*]Kullanıcı ekleme işleminiz başarılı bir şekilde tamamlanmıştır!");
    }

    static void KitapTeslimAl()
    {
        Console.Clear();       
        Console.WriteLine("Kullanıcıdan ID ve ISBN bilgilerini alarak kitabı teslim alabilirsiniz.");
        Console.Write("Kullanıcı ID'sini giriniz: ");
        string idStr = Console.ReadLine();
        int id;
        if (!int.TryParse(idStr, out id))
        {
            Console.Clear();
            Console.WriteLine("$Hata: ID yalnızca sayısal bir değer olmalıdır!\nLütfen tekrar deneyiniz.");
            KitapTeslimAl();
            return;
        }

        Console.Write("Kitap ISBN numarasını (sadece sayı) giriniz: ");
        string isbnStr = Console.ReadLine();
        int isbn;
        if (!int.TryParse(isbnStr, out isbn))
        {
            Console.Clear();
            Console.WriteLine("$Hata: ISBN yalnızca sayısal bir değer olmalıdır!\nLütfen tekrar deneyiniz.");
            KitapTeslimAl();
            return;
        }

        Kullanici kullanici = kullaniciListesi.Find(k => k.ID == id);
        Kitap kitap = kitapListesi.Find(k => k.ISBN == isbn);

        if (kullanici == null)
        {
            Console.WriteLine("\n\n$Hata: Belirtilen ID ile kayıtlı bir kullanıcı bulunamadı!");
        }
        else if (kitap == null)
        {
            Console.WriteLine("\n\n$Hata: Belirtilen ISBN ile kayıtlı bir kitap bulunamadı!");
        }
        else if (!kitap.Mevcut)
        {
            Console.WriteLine("\n\n$Hata: Belirtilen kitap zaten ödünç verilmiş!");
        }
        else
        {
            kitap.Mevcut = false;
            kullanici.OduncKitapEkle(isbn);
            Console.WriteLine("\n\n[*]Kitap başarıyla teslim alındı!");
        }
    }

    static void KitapOduncVer()
    {
        Console.Clear();       
        Console.WriteLine("Kullanıcıdan ID ve ISBN bilgilerini alarak kitabı ödünç verebilirsiniz.");
        Console.Write("Kullanıcı ID'sini giriniz: ");
        string idStr = Console.ReadLine();
        int id;
        if (!int.TryParse(idStr, out id))
        {
            Console.Clear();
            Console.WriteLine("$Hata: ID yalnızca sayısal bir değer olmalıdır!\nLütfen tekrar deneyiniz.");
            KitapOduncVer();
            return;
        }

        Console.Write("Kitap ISBN'sini giriniz: ");
        string isbnStr = Console.ReadLine();
        int isbn;
        if (!int.TryParse(isbnStr, out isbn))
        {
            Console.Clear();
            Console.WriteLine("$Hata: ISBN yalnızca sayısal bir değer olmalıdır!\nLütfen tekrar deneyiniz.");
            KitapOduncVer();
            return;
        }
        Kullanici kullanici = kullaniciListesi.Find(k => k.ID == id);
        Kitap kitap = kitapListesi.Find(k => k.ISBN == isbn);

        if (kullanici == null)
        {
            Console.WriteLine("\n\n$Hata: Belirtilen ID ile kayıtlı bir kullanıcı bulunamadı!");
        }
        else if (kitap == null)
        {
            Console.WriteLine("\n\n$Hata: Belirtilen ISBN ile kayıtlı bir kitap bulunamadı!");
        }
        else if (kitap.Mevcut == false)
        {
            Console.WriteLine("\n\n$Hata: Belirtilen kitap zaten ödünç verilmiş!");
        }
        else
        {
            kullanici.OduncKitapEkle(isbn);
            kitap.Mevcut = false;
            Console.WriteLine("\n\n[*]Kitap başarıyla ödünç verildi!");
        }
    }
    static void KitapTeslimEt()
    {
        Console.Clear();      
        Console.WriteLine("Kullanıcıdan ID ve ISBN bilgilerini alarak kitabı teslim edebilirsiniz.");
        Console.Write("Kullanıcı ID'sini giriniz: ");
        string idStr = Console.ReadLine();
        int id;
        if (!int.TryParse(idStr, out id))
        {
            Console.Clear();
            Console.WriteLine("$Hata: ID yalnızca sayısal bir değer olmalıdır!\nLütfen tekrar deneyiniz.");
            KitapTeslimEt();
            return;
        }

        Console.Write("Kitap ISBN kodunu giriniz: ");
        string isbnStr = Console.ReadLine();
        int isbn;
        if (!int.TryParse(isbnStr, out isbn))
        {
            Console.Clear();
            Console.WriteLine("$Hata: ISBN yalnızca sayısal bir değer olmalıdır!\nLütfen tekrar deneyiniz.");
            KitapTeslimEt();
            return;
        }

        Kullanici kullanici = kullaniciListesi.Find(k => k.ID == id);
        Kitap kitap = kitapListesi.Find(k => k.ISBN == isbn);

        if (kullanici == null)
        {
            Console.WriteLine("\n\n$Hata: Belirtilen ID ile kayıtlı bir kullanıcı bulunamadı!");
        }
        else if (kitap == null)
        {
            Console.WriteLine("\n\n$Hata: Belirtilen ISBN ile kayıtlı bir kitap bulunamadı!");
        }
        else if (kitap.Mevcut)
        {
            Console.WriteLine("\n\n$Hata: Belirtilen kitap zaten kütüphanede mevcut!");
        }
        else if (!kullanici.OduncKitaplar.Contains(isbn))
        {
            Console.WriteLine("\n\n$Hata: Belirtilen kullanıcı ödünç alınan bu kitabı bulundurmuyor!");
        }
        else
        {
            kitap.Mevcut = true;
            kullanici.OduncKitaplar.Remove(isbn);
            Console.WriteLine("\n\n[*]Kitap başarıyla teslim edildi!");
        }
    }

    static void KullaniciListele()
    {
        Console.Clear();
        Console.WriteLine("KULLANICI LISTESI");

        foreach (Kullanici kullanici in kullaniciListesi)
        {
            Console.WriteLine($"ID: {kullanici.ID}\nİsim: {kullanici.Isim}\nSoyisim: {kullanici.Soyisim}\nDoğum Yılı: {kullanici.DogumYili}\nOkuduğu Bölüm: {kullanici.Bolum}\nÖdünç Aldığı Kitaplar: {string.Join(", ", kullanici.OduncKitaplar)}");           
        }
        Console.WriteLine("");
        Menu();
    }

    static void KitapListele()
    {
        Console.Clear();
        Console.WriteLine("KITAP LISTESI");       
        foreach (Kitap kitap in kitapListesi)
        {
            Console.WriteLine($"ISBN: {kitap.ISBN}\nKitap Adı: {kitap.KitapAdi}\nYazar: {kitap.Yazar}\nYayın Yılı: {kitap.YayinYili}\nMevcut: {kitap.Mevcut}");            
        }
        Console.WriteLine("");
        Menu();
    }
    static void kitapDosya()
    {
        Console.Clear();
        Console.WriteLine("KITAP DOSYASI");

        using (StreamReader reader = new StreamReader("kitaplar.txt"))
        {
            string line;
            while ((line = reader.ReadLine()) != null)
            {
                Console.WriteLine(line);
            }
        }

        Console.WriteLine("Kitap dosyası başarıyla açıldı.");
        Menu();
    }

    static void kullaniciDosya()
    {
        Console.Clear();
        Console.WriteLine("KULLANICI DOSYASI");

        using (StreamReader reader = new StreamReader("kullanicilar.txt"))
        {
            string line;
            while ((line = reader.ReadLine()) != null)
            {
                Console.WriteLine(line);
            }
        }

        Console.WriteLine("Kullanıcı dosyası başarıyla açıldı.");
        Menu();
    }

}
